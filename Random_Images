for j = 1:1:3528
   
   clf;
   name = myFiles(j).name;
   current_image = extractAfter(name,2);
   Image = imread(current_image);
   Index = 1;
   num = 1;
   [Image_Height,Image_Width,Number_Of_Colour_Channels] = size(Image);
   Block_Size = 250;
   Number_Of_Blocks_Vertically = floor(Image_Height/Block_Size);
   Number_Of_Blocks_Horizontally = floor(Image_Width/Block_Size);
   Image_Blocks = struct('Blocks',[]);
   finalArr = strings(2000,6);
   finalArr(1,:) = ["WellIndex","FileName","Type","Treatment","Iteration","TimePoint"];
   group = extractBetween(current_image,9,10);
   iteration = extractBetween(current_image,12,13);
   timepoint = extractBetween(current_image,15,32);

   if strcmp(group,"B2")
       treatment = "no stress";
   end
   if strcmp(group,"B3")
       treatment = "50 nM PLX";
   end
   if strcmp(group,"B4")
       treatment = "5% EtOH";
   end
   if strcmp(group,"C2")
       treatment = "0.5 mM H2";
   end
   if strcmp(group,"C3")
       treatment = "no glucose";
   end
   if strcmp(group,"C4")
       treatment = "50 nM thapsagargin";
   end

   for Row = 1: +Block_Size: Number_Of_Blocks_Vertically*Block_Size
     for Column = 1: +Block_Size: Number_Of_Blocks_Horizontally*Block_Size
        
     Row_End = Row + Block_Size - 1;
     Column_End = Column + Block_Size - 1;
        
     if Row_End > Image_Height
       Row_End = Image_Height;
     end
    
     if Column_End > Image_Width
       Column_End = Image_Width;
     end
     
     arr = randperm(Number_Of_Blocks_Vertically,2);
     for z = 1:Number_Of_Blocks_Vertically

       Temporary_Tile = Image(Row:Row_End,Column:Column_End,:);
       Image_Blocks(Index).Blocks = Temporary_Tile;
       if ismember(Index,arr)
       figName = append(string(num),'.jpg');
       subplot(Number_Of_Blocks_Vertically,Number_Of_Blocks_Horizontally,Index); imshow(Temporary_Tile);
       saveas(gcf,figName,'jpg');
       num = num + 1;
       numstr = string(num);
       finalArr(num,:) = [numstr,current_image,group,treatment,iteration,timepoint];
       end
     end
     
     clf;
     Index = Index + 1;
    
     end  
   end
end
writematrix(finalArr,'TestMetaData.csv.txt');
